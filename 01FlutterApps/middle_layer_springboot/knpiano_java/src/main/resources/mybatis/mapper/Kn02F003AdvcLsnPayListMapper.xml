<?xml version="1.0" encoding="UTF-8" ?>
<!--
关于Mybatis的SQL文件映射该怎么写，我们要参照Mybatis的官方文档，官方文档都托管到了GitHub下
我们就从GitHub网站去搜索MyBatis的相关资料
配置的参照例子
https://mybatis.org/mybatis-3/getting-started.html

-->
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.liu.springboot04web.dao.Kn02F003AdvcLsnPayListDao">

    <!-- 检查课程Id，课费Id，支付Id 在课费预支付表里是否存在 -->
    <select id="getAdvcLsnPayStuName" resultType="com.liu.springboot04web.bean.Kn02F003AdvcLsnFeePayBean">
        SELECT
            lsn.stu_id,
            lsn.stu_name
        FROM
            v_info_lesson lsn
        INNER JOIN 
            t_info_lsn_fee_advc_pay advc ON lsn.lesson_id = advc.lesson_id
        INNER JOIN
            t_info_lesson_pay pay ON pay.lsn_pay_id = advc.lsn_pay_id
                                AND advc.lsn_fee_id = pay.lsn_fee_id 
        INNER JOIN
            t_mst_bank bnk ON pay.bank_id = bnk.bank_id
        <where>
            substring(schedual_date,1,4) = #{year}
        </where>
    </select>

    <select id="getAdvcLsnPayList" resultType="com.liu.springboot04web.bean.Kn02F003AdvcLsnPayListBean">
        SELECT
            advc.lesson_id,
            advc.lsn_fee_id,
            advc.lsn_pay_id,
            lsn.stu_id,
            lsn.stu_name,
            lsn.nik_name,
            lsn.subject_id,
            lsn.subject_name,
            lsn.subject_sub_id,
            lsn.subject_sub_name,
            lsn.schedual_date,
            pay.lsn_pay,
            pay.bank_id,
            bnk.bank_Name,
            advc.advc_flg
        FROM
            v_info_lesson lsn
        INNER JOIN 
            t_info_lsn_fee_advc_pay advc ON lsn.lesson_id = advc.lesson_id
        INNER JOIN
            t_info_lesson_pay pay ON pay.lsn_pay_id = advc.lsn_pay_id
                                AND advc.lsn_fee_id = pay.lsn_fee_id 
        INNER JOIN
            t_mst_bank bnk ON pay.bank_id = bnk.bank_id
        <where>
            <if test="stuId != null and stuId != ''">
                AND stu_id = #{stuId}
            </if>
            <if test="year != null and year != ''">
                AND substring(schedual_date,1,4) = #{year}
            </if>
        </where>
        ORDER BY schedual_date DESC
    </select>

</mapper>