/* æ¢æ­£è¯¾æ•ˆæœæ ·å¼ - ä½¿ç”¨æ›´æ´»æ³¼çš„é¢œè‰²æ­é… */
        .badge.change-effect-good {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%) !important;
            color: white !important;
            font-size: 12px !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
            display: inline-block !important;
            min-width: 100px !important;
            text-align: center !important;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.4) !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2) !important;
            transition: all 0.3s ease !important;
        }

        .badge.change-effect-good:hover {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.5) !important;
        }

        .badge.change-effect-bad {
            background: linear-gradient(135deg, #e91e63 0%, #f06292 100%) !important;
            color: white !important;
            font-size: 12px !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
            display: inline-block !important;
            min-width: 100px !important;
            text-align: center !important;
            box-shadow: 0 3px 10px rgba(233, 30, 99, 0.4) !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2) !important;
            transition: all 0.3s ease !important;
        }

        .badge.change-effect-bad:hover {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.5) !important;
        }

        .badge.change-effect-neutral {
            background: linear-gradient(135deg, #3f51b5 0%, #5c6bc0 100%) !important;
            color: white !important;
            font-size: 12px !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
            display: inline-block !important;
            min-width: 80px !important;
            text-align: center !important;
            box-shadow: 0 3px 10px rgba(63, 81, 181, 0.4) !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2) !important;
            transition: all 0.3s ease !important;
        }

        .badge.change-effect-neutral:hover {
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 5px 15px rgba(63, 81, 181, 0.5) !important;
        }

        /* ç¡®ä¿åœ¨è¡¨æ ¼ä¸­çš„èƒ¶å›Šæ ·å¼ç”Ÿæ•ˆ */
        .styled-table td .badge.change-effect-good,
        .tab-content .styled-table td .badge.change-effect-good,
        table td .badge.change-effect-good {
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%) !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 8px 15px !important;
            min-width: 100px !important;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.4) !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2) !important;
        }

        .styled-table td .badge.change-effect-bad,
        .tab-content .styled-table td .badge.change-effect-bad,
        table td .badge.change-effect-bad {
            background: linear-gradient(135deg, #e91e63 0%, #f06292 100%) !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 8px 15px !important;
            min-width: 100px !important;
            box-shadow: 0 3px 10px rgba(233, 30, 99, 0.4) !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2) !important;
        }

        .styled-table td .badge.change-effect-neutral,
        .tab-content .styled-table td .badge.change-effect-neutral,
        table td .badge.change-effect-neutral {
            background: linear-gradient(135deg, #3f51b5 0%, #5c6bc0 100%) !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 8px 15px !important;
            min-width: 80px !important;
            box-shadow: 0 3px 10px rgba(63, 81, 181, 0.4) !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2) !important;
        }

        /* åˆ—æ§åˆ¶æŒ‰é’®ä¼˜åŒ– - é…åˆæ•´ä½“è‰²è°ƒ */
        .column-control button {
            background: linear-gradient(45deg, #9c27b0, #673ab7) !important;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(156, 39, 176, 0.3);
        }

        .column-control button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.4);
            background: linear-gradient(45deg, #8e24aa, #5e35b1) !important;
        }<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Fragments</title>
    <style>
        /* åªä¿ç•™åˆ—æ§åˆ¶åŠŸèƒ½çš„æ ·å¼ï¼Œè¡¨æ ¼æ ·å¼å…¨éƒ¨ç§»åˆ°ä¸»é¡µé¢ */
        .column-control {
            position: relative;
            margin: 20px;
            display: inline-block;
        }

        .column-control button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .column-control button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .column-menu {
            position: absolute;
            background: white;
            border: none;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
            right: 0;
            top: 100%;
            min-width: 200px;
            margin-top: 5px;
        }

        .column-menu.show {
            display: block;
        }

        .column-menu label {
            display: block;
            padding: 8px 12px;
            cursor: pointer;
            white-space: nowrap;
            border-radius: 6px;
            transition: background-color 0.2s ease;
            font-weight: normal;
            margin: 2px 0;
        }

        .column-menu label:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        .column-menu input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.1);
        }

        /* ç¡®ä¿æ“ä½œåˆ—å§‹ç»ˆæ˜¾ç¤º */
        .action-column {
            display: table-cell !important;
        }

        /* æ¢æ­£è¯¾æ•ˆæœæ ·å¼ - ä½¿ç”¨Bootstrapçš„badgeç±»å¹¶å¼ºåŒ–èƒ¶å›Šé£æ ¼ */
        .badge.change-effect-good {
            background-color: #28a745 !important;
            color: white !important;
            font-size: 12px !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
            display: inline-block !important;
            min-width: 100px !important;
            text-align: center !important;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.4) !important;
        }

        .badge.change-effect-bad {
            background-color: #dc3545 !important;
            color: white !important;
            font-size: 12px !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
            display: inline-block !important;
            min-width: 100px !important;
            text-align: center !important;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4) !important;
        }

        .badge.change-effect-neutral {
            background-color: #6c757d !important;
            color: white !important;
            font-size: 12px !important;
            padding: 8px 15px !important;
            border-radius: 20px !important;
            font-weight: bold !important;
            display: inline-block !important;
            min-width: 80px !important;
            text-align: center !important;
            box-shadow: 0 2px 8px rgba(108, 117, 125, 0.4) !important;
        }

        /* ç¡®ä¿åœ¨è¡¨æ ¼ä¸­çš„èƒ¶å›Šæ ·å¼ç”Ÿæ•ˆ */
        .styled-table td .badge.change-effect-good,
        .tab-content .styled-table td .badge.change-effect-good,
        table td .badge.change-effect-good {
            background-color: #28a745 !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 8px 15px !important;
            min-width: 100px !important;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.4) !important;
        }

        .styled-table td .badge.change-effect-bad,
        .tab-content .styled-table td .badge.change-effect-bad,
        table td .badge.change-effect-bad {
            background-color: #dc3545 !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 8px 15px !important;
            min-width: 100px !important;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4) !important;
        }

        .styled-table td .badge.change-effect-neutral,
        .tab-content .styled-table td .badge.change-effect-neutral,
        table td .badge.change-effect-neutral {
            background-color: #6c757d !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 8px 15px !important;
            min-width: 80px !important;
            box-shadow: 0 2px 8px rgba(108, 117, 125, 0.4) !important;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .column-menu {
                right: auto !important;
                left: 0 !important;
                min-width: 180px !important;
            }
            
            .change-effect-good,
            .change-effect-bad,
            .change-effect-neutral {
                font-size: 10px !important;
                padding: 4px 8px !important;
                min-width: 60px !important;
            }
        }
    </style>
</head>

<body>
    <div th:fragment="lessonTable(stuid, stuName)">
        <!-- åˆ—æ§åˆ¶æŒ‰é’®å’Œèœå• -->
        <div class="column-control">
            <button onclick="toggleColumnMenu(event)">
                ğŸ”§ æ˜¾ç¤º/éšè—åˆ—
            </button>
            <div id="columnMenu" class="column-menu">
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-stuId')" /> å­¦ç”Ÿç¼–å·
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-lessonId')" /> è¯¾ç¨‹ç¼–å·
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-subjectId')" /> ç§‘ç›®ç¼–å·
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-subjectName')" /> ç§‘ç›®åç§°
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-oldSubjectSubName')" /> åŠ è¯¾æ—¶çš„å­ç§‘ç›®åç§°
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-oldLsnFee')" /> åŠ è¯¾æ—¶çš„ç§‘ç›®å•ä»·
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-newSubjectSubName')" /> æ¢æ­£è¯¾åçš„å­ç§‘ç›®åç§°
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-newLsnFee')" /> æ¢æ­£è¯¾åçš„ç§‘ç›®å•ä»·
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-fromExtraScanDate')" /> åŠ è¯¾æ—¶è¯¾ç¨‹æ—¥æœŸ
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-toScheScanDate')" /> æ¢æ­£è¯¾æ—¥æœŸ
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-isGoodChange')" /> æ¢æ­£è¯¾æœæ•ˆ
                </label>
                <label>
                    <input type="checkbox" checked onchange="toggleColumn('col-memoReason')" /> æ¢æ­£è¯¾æ— æ„ä¹‰ç†ç”±
                </label>
            </div>
        </div>
        <div th:id="${stuid}" class="tab-pane fade" th:classappend="'show active'" style="overflow-x: auto; max-width: 100%;">
            <table class="table styled-table table-sm">
                <thead>
                    <tr>
                        <th class="col-stuId">å­¦ç”Ÿ<br>ç¼–å·</th>
                        <th class="col-lessonId">è¯¾ç¨‹<br>ç¼–å·</th>
                        <th class="col-subjectId">ç§‘ç›®<br>ç¼–å·</th>
                        <th class="col-subjectName">ç§‘ç›®<br>åç§°</th>
                        <th class="col-oldSubjectSubName">åŠ è¯¾æ—¶çš„<br>å­ç§‘ç›®åç§°</th>
                        <th class="col-oldLsnFee">åŠ è¯¾æ—¶çš„<br>ç§‘ç›®å•ä»·</th>
                        <th class="col-newSubjectSubName">æ¢æ­£è¯¾åçš„<br>å­ç§‘ç›®åç§°</th>
                        <th class="col-newLsnFee">æ¢æ­£è¯¾åçš„<br>ç§‘ç›®å•ä»·</th>
                        <th class="col-fromExtraScanDate">åŠ è¯¾æ—¶<br>è¯¾ç¨‹æ—¥æœŸ</th>
                        <th class="col-toScheScanDate">æ¢æ­£è¯¾<br>æ—¥æœŸ</th>
                        <th class="col-isGoodChange">æ¢æ­£è¯¾<br>æœæ•ˆ</th>
                        <th class="col-memoReason">æ¢æ­£è¯¾<br>æ— æ„ä¹‰ç†ç”±</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="info : ${infoList}" th:if="${info.stuName == stuName}">
                        <td class="col-stuId">[[${info.stuId}]]</td>
                        <td class="col-lessonId">[[${info.lessonId}]]</td>
                        <td class="col-subjectId">[[${info.subjectId}]]</td>
                        <td class="col-subjectName">[[${info.subjectName}]]</td>
                        <td class="col-oldSubjectSubName">[[${info.oldSubjectSubName}]]</td>
                        <td class="col-oldLsnFee">Â¥[[${info.oldLsnFee}]]</td>
                        <td class="col-newSubjectSubName">[[${info.newSubjectSubName}]]</td>
                        <td class="col-newLsnFee">Â¥[[${info.newLsnFee}]]</td>
                        <td class="col-fromExtraScanDate">[[${info.fromExtraScanDate != null ?
                        #dates.format(info.fromExtraScanDate,'yyyy/MM/dd') : ''}]]</td>
                        <td class="col-toScheScanDate">[[${info.toScheScanDate != null ?
                        #dates.format(info.toScheScanDate,'yyyy/MM/dd') : ''}]]</td>
                        <td class="col-isGoodChange">
                            <span th:if="${info.isGoodChange == 1}" class="badge badge-success change-effect-good">æœ‰æ„ä¹‰çš„æ¢æ­£è¯¾</span>
                            <span th:if="${info.isGoodChange == 0}" class="badge badge-danger change-effect-bad">æ— æ„ä¹‰çš„æ¢æ­£è¯¾</span>
                            <span th:if="${info.isGoodChange == null}" class="badge badge-secondary change-effect-neutral">æœªè®¾ç½®</span>
                        </td>
                        <td class="col-memoReason" th:utext="${info.memoReason}">[[${info.memoReason}]]</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- åˆ—æ§åˆ¶ç›¸å…³çš„ JavaScript -->
        <script th:inline="javascript">
            // å­˜å‚¨åˆ—æ˜¾ç¤ºçŠ¶æ€
            var columnStates = JSON.parse(localStorage.getItem('columnStates') || '{}');

            // æ§åˆ¶åˆ—æ˜¾ç¤ºèœå•çš„æ˜¾ç¤º/éšè—
            function toggleColumnMenu(event) {
                event.stopPropagation();
                const menu = document.getElementById('columnMenu');
                menu.classList.toggle('show');
            }

            // æ§åˆ¶åˆ—çš„æ˜¾ç¤º/éšè—ï¼ˆåŒæ­¥åˆ°æ‰€æœ‰Tabï¼‰
            function toggleColumn(columnClass) {
                // æ›´æ–°çŠ¶æ€
                columnStates[columnClass] = !columnStates[columnClass];
                const isVisible = columnStates[columnClass];

                // æ›´æ–°æ‰€æœ‰å…·æœ‰è¯¥ç±»åçš„å…ƒç´ 
                const cells = document.getElementsByClassName(columnClass);
                Array.from(cells).forEach(cell => {
                    cell.style.display = isVisible ? '' : 'none';
                });

                // ä¿å­˜çŠ¶æ€
                localStorage.setItem('columnStates', JSON.stringify(columnStates));

                // åŒæ­¥æ‰€æœ‰Tabä¸­çš„å¤é€‰æ¡†çŠ¶æ€
                const checkboxes = document.querySelectorAll(`input[onchange="toggleColumn('${columnClass}')"]`);
                checkboxes.forEach(checkbox => {
                    checkbox.checked = isVisible;
                });
            }

            // åº”ç”¨ä¿å­˜çš„åˆ—çŠ¶æ€
            function applyColumnStates() {
                Object.entries(columnStates).forEach(([columnClass, isVisible]) => {
                    const cells = document.getElementsByClassName(columnClass);
                    Array.from(cells).forEach(cell => {
                        cell.style.display = isVisible ? '' : 'none';
                    });

                    // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
                    const checkboxes = document.querySelectorAll(`input[onchange="toggleColumn('${columnClass}')"]`);
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = isVisible;
                    });
                });
            }

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
            document.addEventListener('click', function (event) {
                const menu = document.getElementById('columnMenu');
                if (!event.target.closest('.column-control')) {
                    menu.classList.remove('show');
                }
            });

            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–åˆ—çŠ¶æ€
            document.addEventListener('DOMContentLoaded', function () {
                applyColumnStates();
            });

            // ç›‘å¬Tabåˆ‡æ¢äº‹ä»¶
            document.addEventListener('shown.bs.tab', function () {
                applyColumnStates();
            });
        </script>
    </div>
</body>

</html>