<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.0.1">
    <title>Dashboard Template Â· Bootstrap</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/dashboard/">

    <!-- Bootstrap core CSS -->
    <link href="../assets/dist/css/bootstrap.css" th:href="@{/webjars/bootstrap/4.5.0/css/bootstrap.css}" rel="stylesheet">
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
    <!-- Custom styles for this template -->
    <link href="dashboard.css" th:href="@{/dashboard/dashboard.css}"  rel="stylesheet">
</head>
<body>
<div th:replace="~{commons/bar::topbar}"></div>
<div class="container-fluid">
    <div class="row">
       <div th:replace="~{commons/bar::sidebar(activeUri='kn_lsn_counting_active')}"></div>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
            <h2 class="mt-4 mb-2">å­¦ç”Ÿè¯¾æ—¶è¿›åº¦ç»Ÿè®¡</h2>
            <p class="text-muted small mb-4" style="font-size: 0.875rem;">
                â˜…ä¸šåŠ¡è¯´æ˜ï¼š
            </p>
            <hr/>
            <h2 th:text="${lsnCountingMap?.year != null ? lsnCountingMap.year : currentyear} + 'å¹´åº¦è¯¾æ—¶ç»Ÿè®¡æŠ¥è¡¨'"></h2>
            <hr/>
            <!-- æ¤œç´¢éƒ¨ -->
            <form action="#" th:action="@{/kn_lsn_counting/search}" method="get" onsubmit="return validateDateRange()">
                <div class="form-row">
                    <div class="form-group col-md-3" style="margin-bottom: 20px;">
                        <label for="lsncountingyear">ç»Ÿè®¡å¹´åº¦</label>
                        <select class="form-control" id="lsncountingyear" name="year">
                            <option th:each="year : ${knyearlist}" 
                                    th:value="${year}" 
                                    th:text="${year}" 
                                    th:selected="${year == (lsnCountingMap?.year != null ? lsnCountingMap.year : currentyear)}"></option>
                        </select>
                    </div>
                    <div class="form-group col-md-3" style="margin-bottom: 20px;">
                        <label for="monthFrom">å¼€å§‹æœˆä»½</label>
                        <select class="form-control" id="monthFrom" name="monthFrom">
                            <option th:each="month : ${knmonthlist}" 
                                    th:value="${month}" 
                                    th:text="${month + 'æœˆ'}" 
                                    th:selected="${month == (lsnCountingMap?.monthFrom != null ? lsnCountingMap.monthFrom : '01')}"></option>
                        </select>
                    </div>
                    <div class="form-group col-md-3" style="margin-bottom: 20px;">
                        <label for="monthTo">ç»“æŸæœˆä»½</label>
                        <select class="form-control" id="monthTo" name="monthTo">
                            <option th:each="month : ${knmonthlist}" 
                                    th:value="${month}" 
                                    th:text="${month + 'æœˆ'}" 
                                    th:selected="${month == (lsnCountingMap?.monthTo != null ? lsnCountingMap.monthTo : currentmonth)}"></option>
                        </select>
                    </div>
                    <div class="form-group col-md-3 d-flex align-items-end" style="margin-bottom: 20px;">
                        <button type="submit" class="btn btn-primary">æ£€ç´¢</button>
                    </div>
                </div>
            </form>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                    <tr>
                        <th>å­¦ç”Ÿç¼–å·</th>
                        <th>å­¦ç”Ÿå§“å</th>
                        <th>ç§‘ç›®ç¼–å·</th>
                        <th>ç§‘ç›®åç§°</th>
                        <th>å·²å®Œæˆè®¡åˆ’è¯¾</th>
                        <th>è§„å®šå¹´æ»¡è¯¾æ—¶</th>
                        <th>è®¡åˆ’è¯¾å®Œæˆåº¦</th>
                        <th>åŠ æ—¶è¯¾</th>
                   </tr>
                    </thead>
                    <tbody>
                    <tr th:each="info:${infoList}"
                        th:style="${info.totalLsnCnt1 != null and info.totalLsnCnt1 != 0.0 and info.totalLsnCnt1 == (info.yearLsnCnt == null or info.yearLsnCnt == 0.0 ? 43.0 : info.yearLsnCnt)} ? 'color: green; font-weight: bold;' : ''">
                        <td>[[${info.stuId}]]</td>
                        <td>
                            <span th:if="${info.totalLsnCnt1 != null and info.totalLsnCnt1 != 0.0 and info.totalLsnCnt1 == (info.yearLsnCnt == null or info.yearLsnCnt == 0.0 ? 43.0 : info.yearLsnCnt)}">âœ…ğŸ†</span>
                            <span>[[${info.stuName}]]</span>
                        </td>
                        <td>[[${info.subjectId}]]</td>
                        <td>[[${info.subjectName}]]</td>
                        <td>
                            <span th:if="${info.totalLsnCnt0 != null and info.totalLsnCnt0 != 0.0}"
                                  style="color: green; font-weight: bold;"
                                  th:text="${info.totalLsnCnt0}"></span>

                            <span th:if="${info.totalLsnCnt1 != null and info.totalLsnCnt1 != 0.0}"
                                  th:style="${info.totalLsnCnt1 == (info.yearLsnCnt == null or info.yearLsnCnt == 0.0 ? 43.0 : info.yearLsnCnt)} ? 'color: green; font-weight: bold;' : 'color: blue; font-weight: bold;'"
                                  th:text="${info.totalLsnCnt1}"></span>
                        </td>
                        <td>[[${(info.yearLsnCnt == null or info.yearLsnCnt == 0.0) ? 43.0 : info.yearLsnCnt}]]</td>
                        <td>
                            <span th:if="${info.totalLsnCnt0 != null and info.totalLsnCnt0 != 0.0}"
                                  style="color: green; font-weight: bold;"
                                  th:text="${#numbers.formatDecimal((info.totalLsnCnt0/43) * 100,1,1)}+'%'"></span>

                            <span th:if="${info.totalLsnCnt1 != null and info.totalLsnCnt1 != 0.0}"
                                  th:style="${info.totalLsnCnt1 == (info.yearLsnCnt == null or info.yearLsnCnt == 0.0 ? 43.0 : info.yearLsnCnt)} ? 'color: green; font-weight: bold;' : 'color: blue; font-weight: bold;'"
                                  th:text="${#numbers.formatDecimal((info.totalLsnCnt1/(info.yearLsnCnt == 0.0 ? 43 : info.yearLsnCnt)) * 100, 1, 1)} + '%'"></span>
                        </td>
                        <td>
                            <span th:if="${info.totalLsnCnt2 != null and info.totalLsnCnt2 != 0.0}"
                                  style="color: #ff69b4; font-weight: bold;"
                                  th:text="${info.totalLsnCnt2}"></span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </main>
        <!-- å‰Šé™¤å‡¦ç†-->
        <form id="deleteEmpForm" action="" method="post">
            <input type="hidden" name="_method" value="Delete"/>
        </form>
    </div>
</div>
<!--Bootstrap core JavaScrip
=============================-->
<script type="text/javascript" th:src="@{/webjars/jquery/3.5.1/jquery.slim.min.js}"></script>
<script type="text/javascript" th:src="@{/webjars/popper.js/1.16.0/umd/popper.min.js}"></script>
<script type="text/javascript" th:src="@{/webjars/bootstrap/4.5.0/js/bootstrap.min.js}"></script>

<script th:inline="javascript">
    /*<![CDATA[*/
    var currentYear = /*[[${lsnCountingMap?.year != null ? lsnCountingMap.year : currentyear}]]*/ '2024';
    var currentMonthFrom = /*[[${lsnCountingMap?.monthFrom != null ? lsnCountingMap.monthFrom : '01'}]]*/ '01';
    var currentMonthTo = /*[[${lsnCountingMap?.monthTo != null ? lsnCountingMap.monthTo : currentmonth}]]*/ '12';
    /*]]>*/

    document.addEventListener('DOMContentLoaded', function() {
        var yearSelect = document.getElementById('lsncountingyear');
        var monthFromSelect = document.getElementById('monthFrom');
        var monthToSelect = document.getElementById('monthTo');
        
        // ç¡®ä¿é€‰æ‹©æ¡†æ˜¾ç¤ºæ­£ç¡®çš„å€¼
        if (currentYear) {
            yearSelect.value = currentYear;
        }
        if (currentMonthFrom) {
            monthFromSelect.value = currentMonthFrom;
        }
        if (currentMonthTo) {
            monthToSelect.value = currentMonthTo;
        }
    });

    // éªŒè¯æ—¥æœŸèŒƒå›´çš„å‡½æ•°
    function validateDateRange() {
        var monthFromSelect = document.getElementById('monthFrom');
        var monthToSelect = document.getElementById('monthTo');
        
        if (!monthFromSelect || !monthToSelect) {
            console.log('æ— æ³•æ‰¾åˆ°æœˆä»½é€‰æ‹©å…ƒç´ ');
            return false;
        }
        
        // è·å–é€‰ä¸­çš„å€¼ï¼Œå¹¶ç¡®ä¿è½¬æ¢ä¸ºæ•´æ•°
        var monthFromValue = monthFromSelect.value;
        var monthToValue = monthToSelect.value;
        
        // console.log("å¼€å§‹æœˆä»½å€¼:", monthFromValue);
        // console.log("ç»“æŸæœˆä»½å€¼:", monthToValue);
        
        // å¦‚æœå€¼æ˜¯å­—ç¬¦ä¸²æ ¼å¼å¦‚"01", "02"ï¼Œéœ€è¦è½¬æ¢ä¸ºæ•°å­—
        var monthFrom = parseInt(monthFromValue, 10);
        var monthTo = parseInt(monthToValue, 10);
        
        // console.log("è½¬æ¢åå¼€å§‹æœˆä»½:", monthFrom);
        // console.log("è½¬æ¢åç»“æŸæœˆä»½:", monthTo);
        
        if (monthFrom > monthTo) {
            alert('å¼€å§‹æœˆä»½ä¸èƒ½å¤§äºç»“æŸæœˆä»½ï¼Œè¯·é‡æ–°é€‰æ‹©ã€‚\nå½“å‰é€‰æ‹©ï¼šå¼€å§‹æœˆä»½' + monthFrom + 'æœˆï¼Œç»“æŸæœˆä»½' + monthTo + 'æœˆ');
            return false; // é˜»æ­¢è¡¨å•æäº¤
        }
        
        console.log("éªŒè¯é€šè¿‡ï¼Œå…è®¸æäº¤è¡¨å•");
        return true; // å…è®¸è¡¨å•æäº¤
    }
</script>
</body>
</html>